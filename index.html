<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>25h Clock (Non-24)</title>
<style>
  :root{--bg:#0f172a;--panel:#111827cc;--text:#e5e7eb;--muted:#94a3b8;--ring:#334155;--accent:#22d3ee;}
  *{box-sizing:border-box}
  body{margin:0;background:#0b1220;color:var(--text);font-family:-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;min-height:100vh;display:grid;place-items:center;padding:20px}
  .app{width:min(100%,980px);display:grid;grid-template-columns:1fr 1fr;gap:18px}
  @media (max-width:860px){.app{grid-template-columns:1fr}}
  .card{background:var(--panel);backdrop-filter:blur(6px);border:1px solid var(--ring);border-radius:16px;padding:16px 16px 20px}
  h1{margin:0 0 8px;font-size:20px}
  .muted{color:var(--muted)}
  .row{display:flex;justify-content:space-between;gap:12px;align-items:baseline}
  input,button{border:1px solid var(--ring);background:#0b1220;color:var(--text);padding:10px 12px;border-radius:12px;font-size:14px}
  button{cursor:pointer}
  button.primary{background:linear-gradient(135deg,#06b6d4,#22d3ee);border:none;color:#041016;font-weight:700}
  .grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .clock{display:grid;place-items:center}
  svg{width:min(100%,440px);height:auto}
  .tick{stroke:#94a3b86e;stroke-width:1}
  .hand{stroke:var(--text);stroke-linecap:round}
  .sec{stroke:var(--accent)}
  .big{font-weight:800;font-size:36px;letter-spacing:1px;font-variant-numeric:tabular-nums}
</style>
</head>
<body>
<div class="app">
  <section class="card">
    <h1>🕰️ 25 小时一轮回的时钟</h1>
    <p class="muted">一整天设为 <b id="Hlbl">25</b> 小时。可以设置“生物午夜”锚点，时钟以该时刻为 00:00 开始循环。</p>
    <div class="clock">
      <svg viewBox="-110 -110 220 220">
        <circle r="100" fill="#0b1220" stroke="#1f2937" stroke-width="2"></circle>
        <g id="ticks"></g>
        <g id="labels"></g>
        <g id="hands">
          <line id="h" class="hand" x1="0" y1="0" x2="0" y2="-56" stroke-width="4"></line>
          <line id="m" class="hand" x1="0" y1="0" x2="0" y2="-78" stroke-width="3"></line>
          <line id="s" class="hand sec" x1="0" y1="10" x2="0" y2="-86" stroke-width="1.8"></line>
        </g>
        <circle r="3" fill="#22d3ee"></circle>
      </svg>
    </div>
    <div class="row" style="margin-top:10px">
      <div>
        <div class="muted">当前 25h 时间</div>
        <div id="digital" class="big">00:00:00</div>
      </div>
      <div>
        <div class="muted">下一次 00:00（本地）</div>
        <div id="nextMid" style="font-variant-numeric:tabular-nums">—</div>
      </div>
    </div>
  </section>

  <section class="card">
    <h1>⚙️ 设置</h1>
    <div class="grid2">
      <div>
        <div class="muted">一天长度（小时，23–30）</div>
        <input id="cycleHours" type="number" min="23" max="30" step="0.1" value="25">
      </div>
      <div>
        <div class="muted">生物午夜锚点（本地时间）</div>
        <input id="anchor" type="datetime-local">
      </div>
    </div>
    <div style="display:flex;gap:8px;margin-top:12px;flex-wrap:wrap">
      <button id="setNow" class="primary">将当前时间设为 00:00</button>
      <button id="reset">重置到默认（今天 00:00, 25h）</button>
      <button id="clear">清除本机保存</button>
    </div>
    <p class="muted" style="margin-top:10px">提示：可以把一天长度改成 24.5 / 25.2 等。设置会保存在本机浏览器（localStorage）。</p>
  </section>
</div>

<script>
  const $ = s => document.querySelector(s);
  const two = n => String(Math.floor(n)).padStart(2,'0');

  const state = { cycleHours:25, anchorMs:null };
  const KEY_H = 'non24.cycleHours';
  const KEY_A = 'non24.anchorMs';

  function save(){
    localStorage.setItem(KEY_H, String(state.cycleHours));
    if(state.anchorMs!=null) localStorage.setItem(KEY_A, String(state.anchorMs));
  }
  function load(){
    const h = parseFloat(localStorage.getItem(KEY_H));
    if(isFinite(h) && h>=23 && h<=30) state.cycleHours = h;
    const a = parseFloat(localStorage.getItem(KEY_A));
    if(isFinite(a)) state.anchorMs = a;
    $('#cycleHours').value = state.cycleHours;
    $('#Hlbl').textContent = state.cycleHours;
    if(state.anchorMs!=null){
      const d = new Date(state.anchorMs);
      const tz = d.getTimezoneOffset();
      const local = new Date(state.anchorMs - tz*60000);
      $('#anchor').value = local.toISOString().slice(0,16);
    }
  }

  function todayMidnight(){
    const d = new Date(); d.setHours(0,0,0,0); return d;
  }
  function setAnchorTo(date){
    state.anchorMs = date.getTime();
    const tz = date.getTimezoneOffset();
    const local = new Date(state.anchorMs - tz*60000);
    $('#anchor').value = local.toISOString().slice(0,16);
  }

  function buildDial(){
    const H = state.cycleHours;
    $('#ticks').innerHTML = ''; $('#labels').innerHTML = '';
    for(let i=0;i<H;i++){
      const ang = i/H * 2*Math.PI;
      const x1 = Math.sin(ang)*90, y1 = -Math.cos(ang)*90;
      const x2 = Math.sin(ang)*100, y2 = -Math.cos(ang)*100;
      const ln = document.createElementNS('http://www.w3.org/2000/svg','line');
      ln.setAttribute('x1',x1.toFixed(3));
      ln.setAttribute('y1',y1.toFixed(3));
      ln.setAttribute('x2',x2.toFixed(3));
      ln.setAttribute('y2',y2.toFixed(3));
      ln.setAttribute('class','tick');
      ln.setAttribute('stroke-width', (i%5===0?1.8:1));
      $('#ticks').appendChild(ln);
      if(i%5===0){
        const lx = Math.sin(ang)*74, ly = -Math.cos(ang)*74;
        const t = document.createElementNS('http://www.w3.org/2000/svg','text');
        t.setAttribute('x', lx.toFixed(2));
        t.setAttribute('y', (ly+4).toFixed(2));
        t.setAttribute('fill','#cbd5e1');
        t.setAttribute('font-size','8');
        t.setAttribute('text-anchor','middle');
        t.textContent = String(i).padStart(2,'0');
        $('#labels').appendChild(t);
      }
    }
  }

  function circadianNow(){
    const now = Date.now();
    const len = state.cycleHours*3600000; // ms per day
    const delta = ((now - state.anchorMs) % len + len) % len;
    const totalSec = delta/1000;
    const h = Math.floor(totalSec/3600);
    const m = Math.floor((totalSec%3600)/60);
    const s = totalSec%60;
    return {h,m,s,len};
  }

  function update(){
    const {h,m,s,len} = circadianNow();
    $('#digital').textContent = `${two(h)}:${two(m)}:${two(s)}`;

    const H = state.cycleHours;
    const hourAng = ((h + m/60 + s/3600)/H)*360;
    const minAng = (m/60)*360;
    const secAng = (s/60)*360;
    $('#h').setAttribute('transform',`rotate(${hourAng})`);
    $('#m').setAttribute('transform',`rotate(${minAng})`);
    $('#s').setAttribute('transform',`rotate(${secAng})`);

    const now = Date.now();
    const k = Math.floor((now - state.anchorMs)/len) + 1;
    const next = new Date(state.anchorMs + k*len);
    $('#nextMid').textContent = next.toLocaleString();

    requestAnimationFrame(update);
  }

  // events
  $('#cycleHours').addEventListener('change', e=>{
    const v = parseFloat(e.target.value);
    if(isFinite(v) && v>=23 && v<=30){
      state.cycleHours = v;
      $('#Hlbl').textContent = v;
      buildDial();
      save();
    }
  });
  $('#anchor').addEventListener('change', e=>{
    const val = e.target.value; if(!val) return;
    const ms = new Date(val).getTime();
    const tz = new Date().getTimezoneOffset();
    state.anchorMs = ms + tz*60000;
    save();
  });
  $('#setNow').addEventListener('click', ()=>{
    setAnchorTo(new Date());
    save();
  });
  $('#reset').addEventListener('click', ()=>{
    state.cycleHours = 25; $('#cycleHours').value = 25; $('#Hlbl').textContent = 25;
    buildDial(); setAnchorTo(todayMidnight()); save();
  });
  $('#clear').addEventListener('click', ()=>{
    localStorage.removeItem(KEY_H); localStorage.removeItem(KEY_A);
    alert('已清除本机保存。当前页设置未变，如需默认请点“重置”。');
  });

  // boot
  load();
  buildDial();
  if(state.anchorMs==null) setAnchorTo(todayMidnight());
  update();
</script>
</body>
</html>
